<apex:page standardController="HOMEtracker__Property__c" extensions="EAPage2nExtV3,EaPageV2CMExt2"  showHeader="false" applyhtmltag="false" applyBodyTag="false">
    <!-- STYLE -->
    <link href='https://fonts.googleapis.com/css?family=Oswald' rel='stylesheet'></link>


<!-- HEADER BANNER COLOR -->    
    
    <apex:variable var="headColor" value="red"/>
    <apex:variable var="headColor" value="#007cc2"/>
    
    

    <style>
@import url(https://fonts.googleapis.com/css?family=Open+Sans); 
@import url(https://fonts.googleapis.com/css?family=Open+Sans+Condensed);
@import url(https://fonts.googleapis.com/css?family=Oswald);
        .iTable {
            counter-reset: rowCounter;
        }
        .iTable .row {
        counter-increment: rowCounter;
        }
        .iTable .row .counter::before {
            content: counter(rowCounter);
        }       
        .rowInvited {
            background-color:#F1FBF6;
            font-size: 1.2em;
            font-family: 'Open Sans';
            padding: 2px 0px 2px 0px;
            text-align: center;
        }       
        .rowNotInvited {
            background-color:#FBE9E9;
            font-size: 1.2em;
            font-family: 'Open Sans';
            text-align: center;
        }
        .TableTitle{
            font-size: 1.3em !important;
            font-family: 'Open Sans';
            font-weight: bold;
            text-align: center;
        }
         .TableTitleL{
            font-size: 1.3em !important;
            font-family: 'Open Sans';
            font-weight: bold;
            text-align: left;
        }
        .tooltip-wrap {
            position: relative;
        }
        .tooltip-wrap .tooltip-content {
          display: none;
          position: absolute;
          bottom: 5%;
          left: 5%;
          right: 5%;
          background-color: #fff;
          padding: .5em;
          min-width: 10rem;
        }
        .tooltip-wrap:hover .tooltip-content {
          display: block;
          }
        #SectionHeader {          
            margin-left: auto;
            margin-right: auto;
            background-color: {!headColor};
            color: white;
            padding: 2px;
            padding-bottom: 2px;
            width: 90%;
            height: 50px;
            font-size: 1.6em;
            font-family: "Oswald", sans-serif;
        }
      
        #thCenter {
            text-align: center;
            font-size: 1.6em;
            font-weight: 100;            
        }
         #HeaderInfo {          
            margin-left: auto;
            margin-right: auto;
            color: white#007cc2;
            padding: 2px;
            padding-bottom: 2px;
            width: 90%;
            height: 20px;

        }
        #InfoText {
            text-align: right;
            font-size: 1.3em;
            font-family: "Oswald";           
        }
        
        #HelpLink {          
            margin-left: auto;
            margin-right: auto;
            background-color: white;
            padding: 5px;
            padding-bottom: 10px;
            width: 90%;
            height: 75px;
            font-size: 1.0em;
            font-family: "Oswald", sans-serif;
        }
        
        #PropertyDetails {          
            margin-left: auto;
            margin-right: auto;
            background-color: white;
            padding: 5px;
            padding-bottom: 10px;
            width: 90%;
            height: 75px;
            font-size: 1.0em;
            font-family: "Oswald", sans-serif;
        }
        
        #PropertyText {          
            text-align: center;
            font-size: 1.4em;
            font-weight: 100; 
        }
        #clickInvited {          
            white-space: nowrap;
            line-height: 2;
            background-color: #00B050;
            outline-style:solid;
            outline-color:#00B050;
            font-family: "Oswald";
            font-size: 1.8em;
            color: White;
            width: 875 px;
            padding: 2px 20px 2px 20px;
        }
        #Invited {          
            white-space: nowrap;
            line-height: 2;
            color: #00B050;
            outline-style:solid;
            outline-color:#00B050;
            font-family: "Oswald";
            font-size: 1.8em;
            background-color: White;
            width: 875 px;
            padding: 2px 20px 2px 20px;

        }
        #clickNotInvited {          
            white-space: nowrap;
            line-height: 2;
            background-color: #DD4477;
            outline-style:solid;
            outline-color:#DD4477;
            font-family: "Oswald";
            font-size: 1.8em;
            color: white;
            width: 875 px;
            padding: 2px 20px 2px 20px;
        }
        #NotInvited {          
            white-space: nowrap;
            line-height: 2;
            color: #DD4477;
            outline-style:solid;
            outline-color:#DD4477;
            font-family: "Oswald";
            font-size: 1.8em;
            background-color: white;
            width: 875 px;
            padding: 2px 20px 2px 20px;
        }
        #AddMembers{          
            white-space: nowrap;
            line-height: 2;
            background-color: #F2F3F3;
            outline-style:solid;
            outline-color:#007cc2;
            outline-width: thin;
            font-family: "Open Sans";
            font-size: 0.9em;
            padding: 2px 20px 2px 20px;
        }
        #LocalPref{          
            white-space: nowrap;
            line-height: 2;
            background-color: #fff0f0;
            outline-style:solid;
            outline-color:red;
            outline-width: thin;
            font-family: "Open Sans";
            font-size: 1em;
            padding: 6px 20px 6px 20px;
        }
          #SendInvites {          
            white-space: nowrap;
            line-height: 2;
            background-color: #DD4477;
            font-family: "Oswald";
            font-size: 1.2em;
            color: white;
            width: 875 px;
            padding: 2px 20px 2px 20px;
        }
          #Legend{
            text-align: right;
            font-size: 1.3em;
            font-family: "Oswald";           
        }
          #LegendTD{
            outline-style:solid;
            outline-width:thin;
            outline-color: #cfcfcf;
            color: black;
        }
        #FixMPs {          
            white-space: nowrap;
            line-height: 1;
            background-color: #ffffc9;
            outline-style:double;
            outline-color:black;
            font-family: "Open Sans";
            font-size: .8 em;
            color: black;
            width: 875 px;
            padding: 5px 10px 5px 10px;
        }
        #warnInvited{          
            font-family: "Oswald";
            font-size: 1.6em;
            color: #00B050;
        }
          #warnNotInvited{          
            font-family: "Oswald";
            font-size: 1.6em;
            color: #DD4477;
        }
  
    </style>
<script>
function copyText() {
navigator.clipboard.writeText("SELECT Id,Status,Name FROM CampaignMember WHERE Status = 'Not Invited' AND Base_Eligibility_Check__c = true AND Special_Preference_Eligible__c = true AND (Rental_Eligible__c = true OR Ownership_Eligible__c = true) AND CampaignId='{!cId}' ORDER BY EA_Sort__c ASC");}
</script>
  
    <!-- Header -->
    <table id="SectionHeader">
    <th id="thCenter">Eligible Applicants</th>
    </table>
    
    <apex:variable value="{!IF(AND(countMP>0,CountMP<300),'','display:none;')}" var="AddMembersShow1" />
    <apex:variable value="{!IF(countMP>0,'display:none;','')}" var="AddMembersShow2" />
    <apex:variable value="{!IF(countMP>300,'','display:none;')}" var="AddMembersShow3" />
    
    
    <table id="HeaderInfo">
    <tr id="InfoText">
        <td style="text-align: left;">

           <a href="" onclick="window.open('https://cgph--c.vf.force.com/apex/EAPage2?core.apexpages.devmode.url=1','name','width=600,height=200')"><u>click here for email limit</u></a>
           
<!-- TEST VERSION LINK -->           
           <div style="{!IF($User.LastName='Burton','','display:none;')}">
               <a href="https://cgph--c.vf.force.com/apex/EAPage2nV3?cId={!cId}&id={!pId}" target="_blank">
                   VERSION 3
               </a>
<!--               
               <br/>
               <button onclick="copyText()">
                   Copy SOQL
               </button>
--> 
           </div>          
        </td>
        
        
        <td>
            <div style="{!IF(ISBLANK(HOMEtracker__Property__c.Campaign__r.Last_Member_Added_Date__c),'display:none;','')}">
               Last Campaign Members Added Date:
               <b>
               {!CASE(WEEKDAY(DATEVALUE(HOMEtracker__Property__c.Campaign__r.Last_Member_Added_Date__c)),1,'Sun',2,'Mon',3,'Tue',4,'Wed',5,'Thu',6,'Fri',7,'Sat','')}&nbsp;
               <apex:outputField value="{!HOMEtracker__Property__c.Campaign__r.Last_Member_Added_Date__c}"/>
               </b>
               <br/>
           </div>
        </td>
     </tr>
     <tr id="InfoText">
        <td colspan="2">
           <div style="{!IF(ISBLANK(HOMEtracker__Property__c.Campaign__r.Last_Member_Added_Date__c),'display:none;','')}">
               <span id="AddMembers" style="{!AddMembersShow1}">
                   <a href="https://cgph--c.vf.force.com/flow/Create_Campaign_Members_Since_Last_Added_Date?varCID={!$CurrentPage.parameters.cId}&retURL=%2Fapex%2Feapage2nV2%3Fid%3D{!HOMEtracker__Property__c.Id}%26cId%3D{!HOMEtracker__Property__c.Campaign__r.Id}"
                       style="color:black;text-decoration: none;">add {!countMP} new campaign members</a>
               </span>
               <span id="AddMembers" style="outline-color: #AFB5B5; {!AddMembersShow2}">
                   no new campaign members to add
               </span>
               <span id="AddMembers" style="outline-color: red; {!AddMembersShow3}">
                   {!countMP} campaign members to add, manager must import
               </span>
            </div>
        </td>
    </tr>
    <tr id="InfoText">
    <td colspan="2">
    <div style="display:{!IF(OR($User.FirstName='John',$User.FirstName='Nick'),'','none')}">
    <a href="https://cgph.lightning.force.com/lightning/r/Report/00OUq000000N3V3MAK/view?queryScope=userFolders&fv5={!cId}" target="_blank">
    <i>test</i>
    </a>
    </div>
    </td>
    </tr>
    </table>

    <!-- HELP ARTICLE LINK 
    <table id="HelpLink">
    <th id="thCenter"><a href="https://cgph.my.salesforce.com/articles/Homekeeper_knowledge/Eligible-Applicants-Console-Help-Text" target="_blank">EA Page Help Article</a></th>
    </table>   -->
  
  
    <!-- PROPERTY DETAILS -->
    <table id="PropertyDetails">
    <tr>
    <th id="thCenter">
    <a style="font-size: 1.4em;" href="https://cgph.lightning.force.com/{!HOMEtracker__Property__c.Id}" target="_top">{!HOMEtracker__Property__c.Name}</a>
    </th>
    </tr>
    <tr>
        <td style="text-align:center;">
            <span style="font-size:20pt; color:red; background-color:yellow;{!IF(AND(HOMEtracker__Property__c.RecordTypeId='012o00000003bUCAAY',OR(ISNULL(HOMEtracker__Property__c.HOMEtracker__List_Price__c),HOMEtracker__Property__c.HOMEtracker__List_Price__c = 0)),'','display:none;')}">
                <b>PROPERTY LIST PRICE MISSING!</b>
            </span>
        </td>
    </tr>
    <tr>
    <td id="PropertyText">
    {!HOMEtracker__Property__c.HOMEtracker__City__c}, {!HOMEtracker__Property__c.HOMEtracker__State__c}, {!HOMEtracker__Property__c.HOMEtracker__Postal_Code__c} in {!HOMEtracker__Property__c.Municipality_Name__r.Name}<br/>
         {!HOMEtracker__Property__c.HOMEtracker__Number_of_Bedrooms__c}br &#183; {!HOMEtracker__Property__c.HOMEtracker__Number_of_Bathrooms__c}ba &#183; {!HOMEtracker__Property__c.Max_Income_Level__c}<br/>
      {!HOMEtracker__Property__c.HOMEtracker__Property_Type__c} for  
      <span style="display: {!IF(HOMEtracker__Property__c.HOMEtracker__Monthly_Rent__c = 0,'none','')}">
          <apex:outputText value="{0, Number, Currency}">
              <apex:param value="{!HOMEtracker__Property__c.HOMEtracker__Monthly_Rent__c}"/>
          </apex:outputText>
      </span>
      <span style="display: {!IF(HOMEtracker__Property__c.HOMEtracker__List_Price__c = 0,'none','')}">
          <apex:outputText value="{0, Number, Currency}">
              <apex:param value="{!HOMEtracker__Property__c.HOMEtracker__List_Price__c }"/>
          </apex:outputText>
      </span><br/>
      {!SUBSTITUTE(SUBSTITUTE(HOMEtracker__Property__c.Lottery_Number_for_Priority__c,'__c',''),'_',' ')}
      <br/><br/>
    </td>
    </tr>
    <tr>
        <td id="PropertyText">
        <a href="https://cgph.lightning.force.com/lightning/r/Campaign/{!HOMEtracker__Property__c.Campaign__r.Id}/related/CampaignMembers/view" target="_blank"> <i>full campaign member list </i> </a>
        &nbsp;&nbsp;&nbsp;&nbsp;
        <a href="https://cgph.lightning.force.com/lightning/r/Report/00O6O000005tkZ4UAI/view?queryScope=userFolders&fv0={!HOMEtracker__Property__c.Campaign__r.Id}" target="_blank">
        <i>flagged campaign members</i></a>
        <br/>
        <br/>
        </td>
    </tr>
    <tr>
    <td id="PropertyText" style="{!IF(HOMEtracker__Property__c.Consider_Local_Preference__c=true,'','display:none;')}">

<!-- ----------LOCAL PREFERENCE -------------------- -->

    <apex:variable id="listLocalSize" value="{!listLocal.size}" var="listLocalSize"/>
    <div style="{!IF(listLocalSize>0,'','display:none;')}">
        <span id="LocalPref">
            <a style="color:#bd2424; text-decoration: none;"
               href="https://cgph.lightning.force.com/flow/Local_Preference_Unanswered_Mark_Eligible?varCID={!cId}&varMuniID={!HOMEtracker__Property__c.Municipality_Name__r.Id}&retURL=%2Fapex%2Feapage2nV2%3Fid%3D{!HOMEtracker__Property__c.Id}%26cId%3D{!HOMEtracker__Property__c.Campaign__r.Id}">
                   <b>Add {!listLocal.size} Local Eligible Campaign Members</b>
            </a>
        </span>
    </div>
<!--

<div style="{!IF($User.lastName='Burton','','display:none;')}">
    <a style="color:red;" href="https://cgph.lightning.force.com/lightning/r/Report/00O6O000005yT8jUAE/view?queryScope=userFolders&fv0={!HOMEtracker__Property__c.Campaign__r.id}&fv5={!HOMEtracker__Property__c.Municipality_Name__r.Local_Preference_Zip_Codes__c}" target="_blank"> <i>Local Preference Unanswered But Otherwise Eligible</i></a>
</div>
-->
    
    <br/><br/>
    </td>
    </tr>
    
    <!--INVITED / NOT INVITED BUTTONS -->
    <apex:variable value="{!IF(countBadMP>0,'','display:none;')}" var="FixMPShow" />
    <apex:variable value="{!IF(countBadMP>0,'display:none;','')}" var="SendInvitesShow" />
    <apex:variable value="{!IF(countBadMP>0,'false','true')}" var="SendInvitesShow2" />
    
    <tr>
        <td id="PropertyText">
            <a id="Invited" style="text-decoration: none;" href="/apex/EAPage2iV2?id={!HOMEtracker__Property__c.Id}&cId={!HOMEtracker__Property__c.Campaign__r.Id}" target="_top">INVITED {!ROUND(HOMEtracker__Property__c.Campaign__r.Applicants_Invited__c,0)}</a> &nbsp;
            <span id="clickNotInvited" style="text-decoration: none;">NOT INVITED {!countNotInvited}</span> &nbsp;
            <span style="{!SendInvitesShow}"><a id="SendInvites" style="text-decoration: none;" href="https://cgph--c.vf.force.com/flow/EA_Page_Email_MASS_Not_Invited_V2_1?varID={!HOMEtracker__Property__c.Campaign__r.Id}&retURL=%2Fapex%2Feapage2nV2%3Fid%3D{!HOMEtracker__Property__c.Id}%26cId%3D{!HOMEtracker__Property__c.Campaign__r.Id}">SEND BULK EMAILS</a></span><br/>
            <br/><span style="{!FixMPShow}">&nbsp;&nbsp;<a id="FixMPs" style="text-decoration: none;" href="https://cgph.lightning.force.com/lightning/r/Report/00O6O000008nmwaUAA/view?queryScope=userFolders&fv0={!HOMEtracker__Property__c.Campaign__r.Id}">
                <i>{!IF(countBadMP=1,"1 Campaign Member has a problem with their municipality preference",TEXT(countBadMP)&" Campaign Members have problems with their municipality preferences")}, click here to resolve.</i></a><br/></span><br/>
            <span style="{!SendInvitesShow}" id="warnNotInvited">{!IF(l2=1,"RESULTS LIMITED TO 800","")}</span>
        </td>
    </tr>
    <tr>

<!-- TEST LINK

        <td id="PropertyText">
            <div style="{!IF($User.LastName='Burton','','display: none;')}">
                <a href="https://cgph--c.vf.force.com/flow/EA_Page_Email_MASS_Not_Invited_V2_1?varID={!HOMEtracker__Property__c.Campaign__r.Id}&retURL=%2Fapex%2Feapage2nV2%3Fid%3D{!HOMEtracker__Property__c.Id}%26cId%3D{!HOMEtracker__Property__c.Campaign__r.Id}" target="_top">
                TEST LINK
                </a>
            </div>
        </td> 
 -->        
    </tr>
    </table>


<!-- ---------INVITED TABLE------------ -->
<apex:variable var="badEmail" value="#fcf881" />
<apex:variable var="EASort" value="#fc8193;" />
<apex:variable var="flagged" value="#ffb999" />
<apex:variable var="test" value="{!IF($CurrentPage.parameters.t='1','true','false')}" />


<!-- COLOR LEGEND -->
<center>
    <table  id="Legend" width="70%" border="0" style="color:black; text-align:center; font-size:1.1em;">
        <tr>
            <td id="LegendTD" style="padding: 5px 5px 5px 5px; color: black;">
            <b>COLOR LEGEND:</b> 
            </td>
            <td id="LegendTD"  style="background-color:{!badEmail}">
            Applicant has no email
            </td>
            <td id="LegendTD"  style="background-color:{!flagged}; font-size:8pt;">
            <img src="https://cgph--c.vf.force.com/resource/1681836048000/RedFlag" width="12px" /> hover over to see flagged for outreach notes <br/>
            <img src="https://upload.wikimedia.org/wikipedia/commons/1/13/Red_Arrow_Up.svg" width="12px" /> open report of all flagged including or above 
            </td>
            <td id="LegendTD"  style="background-color:{!EASort}">
            Others later in order have been invited already
            </td>
            <td id="LegendTD"  style="color: red !important; background-color:#FBE9E9">
            Email not verified
            </td>
        </tr>
    </table>
</center>
<br/>

 <apex:pageblock id="blockInvited" rendered="{!SendInvitesShow2}">
 
<center>

      <apex:pageblocktable value="{!listNotInvited}" var="i" styleClass="iTable" style="width:75%" rowClasses="row">
            <apex:column styleclass="rowNotInvited" headerClass="TableTitle" headerValue="#"
                style="width:40px;{!if(ISBLANK(i.Email),'background-color:'&badEmail,'')}">
                    <span class="counter"></span></apex:column>
             <apex:column styleclass="rowNotInvited" headerClass="TableTitle" headerValue="CM"
                style="width:20px; {!if(ISBLANK(i.Email),'background-color:'&badEmail,'')}">
                <a style="text-decoration: none;" href="/{!i.Id}" target="_blank"><apex:image url="{!$Resource.blueFileIcon}" width="20px" /></a>
             </apex:column>       
            <apex:column styleclass="rowNotInvited" headerClass="TableTitleL" headerValue="PRE-APPLICANT"
                style="width:180px; text-align: left;{!if(ISBLANK(i.Email),'background-color:'&badEmail,'')}">
                    <apex:outputLink value="/{!i.Pre_Applicant__r.Id}" target="_blank">{!i.Name}</apex:outputLink>
            </apex:column>
                    
                <apex:column styleclass="rowNotInvited" headervalue="FLAG" headerClass="TableTitle"  rendered="true" style="width:70px;{!if(i.Pre_Applicant__r.Flagged_for_Outreach__c=true,'background-color:'&flagged,if(ISBLANK(i.Email),'background-color:'&badEmail,''))}">
                    <span class="tooltip-wrap" style="{!if(i.Pre_Applicant__r.Flagged_for_Outreach__c=true,'','display:none;')};">
                          <img src="https://cgph--c.vf.force.com/resource/1681836048000/RedFlag" width="20px" />
                        <span class="tooltip-content">
                            {!i.Pre_Applicant__r.Flagged_for_Outreach_Notes__c}
                        </span>
                        
                    </span>
                    
                    <span style="{!if(i.Pre_Applicant__r.Flagged_for_Outreach__c=true,'','display:none;')};">
                    &nbsp;&nbsp;&nbsp;&nbsp;
                    <a href="https://cgph.lightning.force.com/lightning/r/Report/00O6O000005tl5yUAA/view?queryScope=userFolders&fv0={!cId}&fv7={!i.EA_Sort__c}" target="_blank">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/1/13/Red_Arrow_Up.svg" width="20px" />
                    </a>
                    </span>
                </apex:column>
               <apex:column styleclass="rowNotInvited" headerClass="TableTitle" headervalue="SKIP" rendered="true"
                style="width:50px;{!if(i.Pre_Applicant__r.Flagged_for_Outreach__c=true,'background-color:'&flagged,if(ISBLANK(i.Email),'background-color:'&badEmail,''))}">
                <img src="{!$Resource.NoMailIcon}" width="20px" style="{!IF(i.Exclude_from_Batch_Email__c=true,'','display:none;')}"/>
            </apex:column>
            <apex:column styleclass="rowNotInvited" headerClass="TableTitle" headervalue="LOTTERY#" value="{!i.Campaign_Member_Lottery_Number__c}"
                style="width:70px;{!if(AND(NOT(ISBLANK(HOMEtracker__Property__c.Campaign__r.Last_EA_Sort_Invited__c)),i.EA_Sort__c <= HOMEtracker__Property__c.Campaign__r.Last_EA_Sort_Invited__c), 'background-color:'&EASort,IF(ISBLANK(i.Email),'background-color:'&badEmail,''))}"/>
            <apex:column styleclass="rowNotInvited" headerClass="TableTitle" headervalue="JOIN DATE" value="{!i.Campaign_Member_Join_Date__c}"
                style="width:80px;{!if(AND(NOT(ISBLANK(HOMEtracker__Property__c.Campaign__r.Last_EA_Sort_Invited__c)),i.EA_Sort__c <= HOMEtracker__Property__c.Campaign__r.Last_EA_Sort_Invited__c), 'background-color:'&EASort,IF(ISBLANK(i.Email),'background-color:'&badEmail,''))}" />
            <apex:column styleclass="rowNotInvited" headerClass="TableTitle" headervalue="MUNI PREF" value="{!i.Muni_Pref__c}"
                style="width:80px;{!if(ISBLANK(i.Email),'background-color:'&badEmail,'')}"/>
            <apex:column styleclass="rowNotInvited" headerClass="TableTitle" headervalue="EMAIL" value="{!i.Email_Verification__c}"
                style="width: 80px;{!IF(ISBLANK(i.Email),'background-color:'&badEmail&';','')}{!if(i.Email_Verification__c='Confirmed','','color:red;')}"/>
            <apex:column styleclass="rowNotInvited" headerClass="TableTitle" headervalue="STATUS" value="{!'Not Invited'}"
                style="width:100px;{!if(ISBLANK(i.Email),'background-color:'&badEmail,'')}"/>
            <apex:column styleclass="rowNotInvited" headerClass="TableTitle" headervalue="INVITE" value="{!i.Action__c}"
                style="width:150px;{!if(ISBLANK(i.Email),'background-color:'&badEmail,'')}"/>
<!-- TEST FIELD      
           <apex:column styleclass="rowNotInvited" headerClass="TableTitle" headervalue="TEST" value="{!i.JB_TEST__c}" rendered="{!IF($User.LastName='Burton','true','false')}"
                style="width:70px;{!if(ISBLANK(i.Email),'background-color:'&badEmail,'')}"/> 
-->                
<!-- SORT FIELD   --> 
           <apex:column styleclass="rowNotInvited" headerClass="TableTitle" headervalue="SORT" value="{!i.EA_Sort__c}" rendered="{!IF($User.LastName='Burton','true','false')}"
                style="width:70px;{!if(ISBLANK(i.Email),'background-color:'&badEmail,'')}"/> 

     </apex:pageblocktable>
</center>
 </apex:pageblock>
 
 
 
 
 
</apex:page>